\documentclass[twocolumn]{jsarticle}
\usepackage[dvipdfmx]{graphicx}
\usepackage{kenzemi}
\usepackage{amsmath}
\usepackage{mathtools}
\usepackage{nidanfloat}

\begin{document}

\title{折り返し型ギルバート乗算回路の周波数特性劣化}
\author{小島 光}
\date{2023年10月2日}
\abstract{以前から検討している折り返し型ギルバート乗算回路について、非線形な動作をする乗算回路について小信号等価回路に手を加え解析を行った。またPMOSの各端子間にキャパシタを付加し、各回路について小信号解析を行った。}
\keyword{ギルバート乗算回路,小信号解析,非線形回路}
\maketitle

\section{はじめに}
以前設計した従来型との比較のために設計した折り返し型ギルバート乗算回路ではサイズの大きなPMOSを使用している。したがって、ゲート面積が増大し寄生容量が大きくなることが考えられる。今週はこの寄生容量について、具体的にどの部分が最も周波数特性劣化の原因として大きいのかを検討した。

\section{動作点の変動}
MOSFETは流れているバイアス電流に応じて動作点が決まり、小信号では動作点付近で動作するため線形回路として扱うことができる。この時、トランスコンダクタンス$g_{m}$はバイアス電流$I_{d}$を用いて
\begin{align}
    g_{m}=2\sqrt{KI_{d}}\label{eq:gm}
\end{align}
と表される。\par

しかし、現在検討しているような乗算回路(図1)では$V_{CTRL}$によってバイアス電流が変動する。これにより一定のトランスコンダクタンス$g_{m}$を用いた小信号等価回路による解析は行えない。そこでまず、PMOSのテール電流が一定であるという仮定のもと小信号等価回路の解析を行った。特に、この乗算回路は完全差動で動作するので今回は図1のように左側の半回路についてのみ考える。

\begin{figure*}[b]
\begin{center}
    \includegraphics*[width=160mm]{figures/folded_gilbert.png}
    \caption{検討中の折り返し型ギルバート乗算回路}
\end{center}
\end{figure*}

\begin{figure}[h]
    \includegraphics*[width=70mm]{figures/FoldedGilbertVctrlEquivalentCircuit.png}
    \caption{PMOSの部分の小信号等価回路}
\end{figure}

図2のように電流を決めると、KCLにより、
\begin{align}
    &i_{u}=i_{l}+i_{r}\label{eq:iu}\\
    &i_{l}=g_{mp}(v_{pS}+v_{d})+g_{dp}(v_{pS}-v_{outl})\label{eq:il}\\
    &i_{r}=g_{mp}(v_{pS}-v_{d})+g_{dp}(v_{pS}-v_{outr})
\end{align}

と表せる。ここで、$V_{CTRL}$の差動成分$v_{d}$が$0$であるとき、$i_{l}=i_{r}$となる。従って
\begin{align*}
    i_{l}&=i_{r}\\
    g_{mp}(v_{pS})+g_{dp}(v_{pS}-v_{outl})&=g_{mp}(v_{pS})+g_{dp}(v_{pS}-v_{outr})\\
    \iff v_{outl}&=v_{outr}
\end{align*}

すなわち

\begin{align}
    i_{u}=2(g_{mp}+g_{dp})v_{pS}
\end{align}

となる。\eqref{eq:gm}式より差動信号が入力されていないとき

\begin{align}
    g_{mp}&=2\sqrt{K\cdot\frac{i_{u}}{2}}=\sqrt{2Ki_{u}}\\
    K&=\frac{g_{mp}^{2}}{2i_{u}}
\end{align}

と表すことができた。次に$v_{d}\ne0$の場合、左側のPMOSのトランスコンダクタンスを$g_{mp}^{\prime}$とすると、\eqref{eq:gm}、\eqref{eq:il}より

\begin{align}
    g_{mp}^{\prime}&=2\sqrt{Ki_{l}}\notag\\
    &=\sqrt{2\cdot\frac{g_{mp}^{2}}{2i_{u}}\cdot \left\{g_{mp}(v_{pS}+v_{d})+g_{dp}(v_{pS}-v_{outl}) \right\}}\notag\\
    &=g_{mp}\sqrt{1+\frac{g_{mp}(v_{pS}+v_{d})+g_{dp}(v_{pS}-v_{outl})}{2(g_{mp}+g_{dp})v_{pS}}}\notag
\end{align}
ここで
\begin{align}
    f(v_{d})\equiv g_{mp}\sqrt{1+\frac{g_{mp}(v_{pS}+v_{d})+g_{dp}(v_{pS}-v_{outl})}{2(g_{mp}+g_{dp})v_{pS}}}
\end{align}
とすると、

\begin{align}
    f(0)&=g_{mp}\sqrt{1+\frac{-g_{dp}v_{outl}+g_{mp}\cdot0}{(g_{mp}+g_{dp})v_{pS}}}\notag\\
    &\approx g_{mp} \notag \\
    \left.\frac{df(v_{d})}{dv_{d}}\right|_{v_{d}=0}&=g_{mp}\cdot\frac{1}{2}\cdot \left\{ 1+\frac{-g_{dp}v_{outl}+g_{mp}v_{d}}{(g_{mp}+g_{dp})v_{pS}} \right\} ^{-\frac{1}{2}}\notag\\
    &\qquad \times\frac{g{mp}}{(g_{mp}+g_{dp})v_{pS}}\notag\\
    &=g_{mp}\cdot\frac{1}{2}\cdot\sqrt{ \frac{(g_{mp}+g_{dp})v_{pS}}{ (g_{mp}+g_{dp})v_{pS}-g_{dp}v_{outl} } }\notag\\
    &\qquad \times\frac{g_{mp}}{(g_{mp}+g_{dp})v_{pS}}\notag\\
    &\approx\frac{g_{mp}}{2}\sqrt{ \frac{g_{mp}v_{pS}}{g_{mp}v_{pS}} }\cdot\frac{g_{mp}}{g_{mp}v_{pS}}=\frac{g_{mp}}{2v_{pS}} 
\end{align}

である。$v_{d}\approx0$のとき、1次近似を行うと

\begin{align}
    f(v_{d})&\approx\left.\frac{df(v_{d})}{dv_{d}}\right|_{v_{d}=0}\cdot v_{d}+f(0) \notag\\
    &=g_{mp}+\frac{g_{mp}}{2v_{pS}}\cdot v_{d} \notag\\
    &\equiv g_{mp}+\Delta g_{m}
\end{align}

と表すことができる。したがって、$v_{d}\approx0$のとき($v_{d}$が小信号であるとき)PMOSのトランスコンダクタンスの増加分は入力電圧に比例することが分かった。即ち、$V_{CTRL}$なる電圧を差動で入力した場合、図2の左右のPMOSのトランスコンダクタンスはそれぞれ$g_{mp}+\Delta g_{m},g_{mp}-\Delta g_{m}$と表すことができる。

\section{回路全体の小信号解析}
前章でPMOSについても小信号等価回路で表現することができるということを示すことができた。これにより回路全体についての小信号等価回路を図3に示す。

\begin{figure*}[b]
    \begin{center}
        \includegraphics*[width=180mm]{figures/FoldedGilbertBaseEquivalentCircuit.png}
        \caption{回路全体の小信号等価回路}
    \end{center}
\end{figure*}

回路全体を小信号等価回路に置き換えることはできたがこれでもまだ複雑である。しかし、本回路中で対応する部分の電流・電圧はそれぞれ異符号かつ等しい絶対値で動作する。従て、対応する部分の片側だけを考えれば事足りる。つまり今回は図4のように$M_{n1},M_{p1},M_{p2}$の小信号等価回路で考えた。

\begin{figure}[h]
    \begin{center}
        \includegraphics*[width=80mm]{figures/FoldedGilbertHalfBaseEquivalentCircuit.png}
        \caption{半回路の小信号等価回路}
    \end{center}
\end{figure}

各部の電流は

\begin{align}
    i_{ul}&=g_{mn}v_{in}-g_{dn}v_{pS1} \label{eq:iul}\\
    i_{ll}&=(g_{mp}+\Delta g_{m})v_{pS1}+g_{dp}(v_{pS1}-v_{out-}) \label{eq:ill}\\
    i_{lr}&=(g_{mp}-\Delta g_{m})v_{pS1}+g_{dp}(v_{pS1}-v_{out+}) \label{eq:ilr}
\end{align}

また、KCL,\eqref{eq:iul},\eqref{eq:ill},\eqref{eq:ilr}より

\begin{align}
    i_{ul}&=i_{ll}+i_{lr} \notag\\
    g_{mn}v_{in}-g_{dn}v_{pS1}&=2g_{mp}v_{pS1}+2g_{dp}v_{pS1} \notag\\
    v_{pS1}&=\frac{g_{mn}}{2g_{mp}}v_{in} \label{eq:vps}
\end{align}

と分かった。ここで差動回路なので$v_{out-}=-v_{out+},i_{ll}=-i_{rr},i_{lr}=-i_{rl}$であることを用いると左側の負荷抵抗$R_{L}$を流れる電流$i_{out-}$は下向きに

\begin{align}
    i_{out-}&=i_{ll}+i_{rl} \notag\\
    &=i_{ll}-i_{lr} \notag\\
    &=2\Delta g_{m}v_{pS1}-2g_{dp}v_{out-}
\end{align}

差動回路なので左側の負荷抵抗を流れる電流$i_{out+}$は

\begin{align}
    i_{out+}&=-i_{out-} \notag\\
    &=-2\Delta g_{m}v_{pS1}+2g_{dp}v_{out-} \notag\\
    &=-2\Delta g_{m}v_{pS1}-2g_{dp}v_{out+}
\end{align}

と表すことができる。

\end{document}